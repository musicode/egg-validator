{"version":3,"file":"index.min.js","sources":["../index.js"],"sourcesContent":["\n'use strict'\n\n// 日期的格式： 2019-11-11\nconst PATTERN_DATE = /^\\d{4}\\-\\d{2}\\-\\d{2}$/\n// 日期时间的格式：2019-11-11 11:11:11\nconst PATTERN_DATE_TIME = /^\\d{4}\\-\\d{2}\\-\\d{2} \\d{2}:\\d{2}:\\d{2}$/\n\n// 获取变量类型，返回小写格式\nfunction getType(value) {\n  return Object.prototype.toString.call(value).toLowerCase().slice(8, -1)\n}\n\nfunction extend(source, props) {\n  for (let key in props) {\n    source[key] = props[key]\n  }\n}\n\nexport function checkInteger(rule, value) {\n  if (getType(value) !== 'number' || value % 1 !== 0) {\n    return 'type'\n  }\n\n  if (rule.hasOwnProperty('min') && value < rule.min) {\n    return 'min'\n  }\n\n  if (rule.hasOwnProperty('max') && value > rule.max) {\n    return 'max'\n  }\n}\n\nexport function checkNumber(rule, value) {\n  if (getType(value) !== 'number' || isNaN(value)) {\n    return 'type'\n  }\n\n  if (rule.hasOwnProperty('min') && value < rule.min) {\n    return 'min'\n  }\n\n  if (rule.hasOwnProperty('max') && value > rule.max) {\n    return 'max'\n  }\n}\n\nexport function checkString(rule, value) {\n\n  if (getType(value) !== 'string') {\n    return 'type'\n  }\n\n  if (value === '') {\n    // 是否允许为空，默认不允许\n    if (rule.empty === true) {\n      return\n    }\n    else {\n      return 'empty'\n    }\n  }\n\n  if (rule.hasOwnProperty('min') && value.length < rule.min) {\n    return 'min'\n  }\n\n  if (rule.hasOwnProperty('max') && value.length > rule.max) {\n    return 'max'\n  }\n\n  if (rule.hasOwnProperty('pattern')\n    && !rule.pattern.test(value)\n  ) {\n    return 'pattern'\n  }\n\n  if (rule.hasOwnProperty('custom')) {\n    const result = rule.custom(value)\n    if (result) {\n      return result\n    }\n  }\n\n}\n\nexport function checkBoolean(rule, value) {\n\n  if (getType(value) !== 'boolean') {\n    return 'type'\n  }\n\n  if (rule.hasOwnProperty('value')\n    && rule.value !== value\n  ) {\n    return 'value'\n  }\n\n}\n\nexport function checkEnum(rule, value) {\n  if (rule.values.indexOf(value) < 0) {\n    return 'type'\n  }\n}\n\nexport function checkArray(rule, value) {\n\n  if (!value || getType(value) !== 'array') {\n    return 'type'\n  }\n\n  const { length } = value\n\n  if (rule.hasOwnProperty('min') && length < rule.min) {\n    return 'min'\n  }\n\n  if (rule.hasOwnProperty('max') && length > rule.max) {\n    return 'max'\n  }\n\n  const { itemType } = rule\n  if (!itemType) {\n    return\n  }\n\n  for (let i = 0; i < length; i++) {\n    if (getType(value[ i ]) !== itemType) {\n      return 'itemType'\n    }\n  }\n\n}\n\nexport function checkObject(rule, value) {\n  if (!value || getType(value) !== 'object') {\n    return 'type'\n  }\n}\n\nexport function checkDate(rule, value) {\n\n  let props = {\n    type: 'string',\n    pattern: PATTERN_DATE,\n  }\n\n  let newRule = {}\n  extend(newRule, rule)\n  extend(newRule, props)\n\n  return checkString(newRule, value)\n\n}\n\nexport function checkDateTime(rule, value) {\n\n  let props = {\n    type: 'string',\n    pattern: PATTERN_DATE_TIME,\n  }\n\n  let newRule = {}\n  extend(newRule, rule)\n  extend(newRule, props)\n\n  return checkString(newRule, value)\n\n}\n\nexport class Validator {\n\n  constructor() {\n    this.rules = {\n      int: checkInteger,\n      integer: checkInteger,\n      number: checkNumber,\n      string: checkString,\n      bool: checkBoolean,\n      boolean: checkBoolean,\n      enum: checkEnum,\n      array: checkArray,\n      object: checkObject,\n      date: checkDate,\n      dateTime: checkDateTime,\n    }\n    this.messages = { }\n  }\n\n  add(name, handler, messages) {\n\n    if (getType(name) === 'object') {\n      extend(this.rules, name)\n      if (getType(handler) === 'object') {\n        extend(this.messages, handler)\n      }\n    }\n    else {\n      this.rules[ name ] = handler\n      this.messages[ name ] = messages\n    }\n\n  }\n\n  validate(data, rules, messages) {\n\n    const errors = { }\n\n    for (let key in rules) {\n\n      let rule = rules[ key ]\n\n      switch (getType(rule)) {\n        case 'string':\n          rule = {\n            type: rule,\n          }\n          break\n\n        case 'array':\n          rule = {\n            type: 'enum',\n            values: rule,\n          }\n          break\n\n        case 'regexp':\n          rule = {\n            type: 'string',\n            pattern: rule,\n          }\n          break\n      }\n\n      if (getType(rule) !== 'object' || !rule.type) {\n        throw new Error(`${key}'s rule is not found.`)\n      }\n\n      let errorReason\n\n      if (data.hasOwnProperty(key)) {\n        errorReason = this.rules[ rule.type ](rule, data[ key ], data)\n      }\n      else {\n        // 默认必传\n        if (rule.required !== false) {\n          errorReason = 'required'\n        }\n        else {\n          continue\n        }\n      }\n\n      if (errorReason) {\n\n        let message = messages && messages[ key ] && messages[ key ][ errorReason ]\n        if (getType(message) !== 'string') {\n          message = this.messages[ rule.type ] && this.messages[ rule.type ][ errorReason ]\n        }\n\n        errors[key] = getType(message) === 'string'\n          ? message\n          : errorReason\n\n      }\n\n    }\n\n    if (Object.keys(errors).length > 0) {\n      return errors\n    }\n\n  }\n\n}\n"],"names":["const","PATTERN_DATE","PATTERN_DATE_TIME","getType","value","Object","prototype","toString","call","toLowerCase","slice","extend","source","props","let","key","checkInteger","rule","hasOwnProperty","min","max","checkNumber","isNaN","checkString","empty","length","pattern","test","result","custom","checkBoolean","checkEnum","values","indexOf","checkArray","itemType","i","checkObject","checkDate","type","newRule","checkDateTime","Validator","this","rules","int","integer","number","string","bool","boolean","enum","array","object","date","dateTime","messages","add","name","handler","validate","data","errors","Error","errorReason","required","message","keys"],"mappings":"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"}