{"version":3,"file":"index.js","sources":["../index.js"],"sourcesContent":["\n'use strict'\n\n// 日期的格式： 2019-11-11\nconst PATTERN_DATE = /^\\d{4}\\-\\d{2}\\-\\d{2}$/\n// 日期时间的格式：2019-11-11 11:11:11\nconst PATTERN_DATE_TIME = /^\\d{4}\\-\\d{2}\\-\\d{2} \\d{2}:\\d{2}:\\d{2}$/\n\n// 获取变量类型，返回小写格式\nfunction getType(value) {\n  return Object.prototype.toString.call(value).toLowerCase().slice(8, -1)\n}\n\nfunction extend(source, props) {\n  for (let key in props) {\n    source[key] = props[key]\n  }\n}\n\nexport function checkInteger(rule, value) {\n  if (getType(value) !== 'number' || value % 1 !== 0) {\n    return 'type'\n  }\n\n  if (rule.hasOwnProperty('min') && value < rule.min) {\n    return 'min'\n  }\n\n  if (rule.hasOwnProperty('max') && value > rule.max) {\n    return 'max'\n  }\n}\n\nexport function checkNumber(rule, value) {\n  if (getType(value) !== 'number' || isNaN(value)) {\n    return 'type'\n  }\n\n  if (rule.hasOwnProperty('min') && value < rule.min) {\n    return 'min'\n  }\n\n  if (rule.hasOwnProperty('max') && value > rule.max) {\n    return 'max'\n  }\n}\n\nexport function checkString(rule, value) {\n\n  if (getType(value) !== 'string') {\n    return 'type'\n  }\n\n  if (value === '') {\n    // 是否允许为空，默认不允许\n    if (rule.empty === true) {\n      return\n    }\n    else {\n      return 'empty'\n    }\n  }\n\n  if (rule.hasOwnProperty('min') && value.length < rule.min) {\n    return 'min'\n  }\n\n  if (rule.hasOwnProperty('max') && value.length > rule.max) {\n    return 'max'\n  }\n\n  if (rule.hasOwnProperty('pattern')\n    && !rule.pattern.test(value)\n  ) {\n    return 'pattern'\n  }\n\n  if (rule.hasOwnProperty('custom')) {\n    const result = rule.custom(value)\n    if (result) {\n      return result\n    }\n  }\n\n}\n\nexport function checkBoolean(rule, value) {\n\n  if (getType(value) !== 'boolean') {\n    return 'type'\n  }\n\n  if (rule.hasOwnProperty('value')\n    && rule.value !== value\n  ) {\n    return 'value'\n  }\n\n}\n\nexport function checkEnum(rule, value) {\n  if (rule.values.indexOf(value) < 0) {\n    return 'type'\n  }\n}\n\nexport function checkArray(rule, value) {\n\n  if (!value || getType(value) !== 'array') {\n    return 'type'\n  }\n\n  const { length } = value\n\n  if (rule.hasOwnProperty('min') && length < rule.min) {\n    return 'min'\n  }\n\n  if (rule.hasOwnProperty('max') && length > rule.max) {\n    return 'max'\n  }\n\n  const { itemType } = rule\n  if (!itemType) {\n    return\n  }\n\n  for (let i = 0; i < length; i++) {\n    if (getType(value[ i ]) !== itemType) {\n      return 'itemType'\n    }\n  }\n\n}\n\nexport function checkObject(rule, value) {\n  if (!value || getType(value) !== 'object') {\n    return 'type'\n  }\n}\n\nexport function checkDate(rule, value) {\n\n  let props = {\n    type: 'string',\n    pattern: PATTERN_DATE,\n  }\n\n  let newRule = {}\n  extend(newRule, rule)\n  extend(newRule, props)\n\n  return checkString(newRule, value)\n\n}\n\nexport function checkDateTime(rule, value) {\n\n  let props = {\n    type: 'string',\n    pattern: PATTERN_DATE_TIME,\n  }\n\n  let newRule = {}\n  extend(newRule, rule)\n  extend(newRule, props)\n\n  return checkString(newRule, value)\n\n}\n\nexport class Validator {\n\n  constructor() {\n    this.rules = {\n      int: checkInteger,\n      integer: checkInteger,\n      number: checkNumber,\n      string: checkString,\n      bool: checkBoolean,\n      boolean: checkBoolean,\n      enum: checkEnum,\n      array: checkArray,\n      object: checkObject,\n      date: checkDate,\n      dateTime: checkDateTime,\n    }\n    this.messages = { }\n  }\n\n  add(name, handler, messages) {\n\n    if (getType(name) === 'object') {\n      extend(this.rules, name)\n      if (getType(handler) === 'object') {\n        extend(this.messages, handler)\n      }\n    }\n    else {\n      this.rules[ name ] = handler\n      this.messages[ name ] = messages\n    }\n\n  }\n\n  validate(data, rules, messages) {\n\n    const errors = { }\n\n    for (let key in rules) {\n\n      let rule = rules[ key ]\n\n      switch (getType(rule)) {\n        case 'string':\n          rule = {\n            type: rule,\n          }\n          break\n\n        case 'array':\n          rule = {\n            type: 'enum',\n            values: rule,\n          }\n          break\n\n        case 'regexp':\n          rule = {\n            type: 'string',\n            pattern: rule,\n          }\n          break\n      }\n\n      if (getType(rule) !== 'object' || !rule.type) {\n        throw new Error(`${key}'s rule is not found.`)\n      }\n\n      let errorReason\n\n      if (data.hasOwnProperty(key)) {\n        errorReason = this.rules[ rule.type ](rule, data[ key ], data)\n      }\n      else {\n        // 默认必传\n        if (rule.required !== false) {\n          errorReason = 'required'\n        }\n        else {\n          continue\n        }\n      }\n\n      if (errorReason) {\n\n        let message = messages && messages[ key ] && messages[ key ][ errorReason ]\n        if (getType(message) !== 'string') {\n          message = this.messages[ rule.type ] && this.messages[ rule.type ][ errorReason ]\n        }\n\n        errors[key] = getType(message) === 'string'\n          ? message\n          : errorReason\n\n      }\n\n    }\n\n    if (Object.keys(errors).length > 0) {\n      return errors\n    }\n\n  }\n\n}\n"],"names":["const","let"],"mappings":"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"}